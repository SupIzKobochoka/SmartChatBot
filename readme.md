# SmartChatBot

## Описание
SmartChatBot — это многокомпонентный чат-бот на базе LangGraph/LangChain. Проект реализует:
- маршрутизацию запросов между специализированными агентами (документы, поиск по базе знаний, журнал активности);
- генерацию документов через инструменты шаблонов;
- поиск по базе знаний на основе векторного хранилища (Chroma);
- работу с журналом активности сотрудников через PostgreSQL.

## Структура каталогов
- `agents/` — агенты и вспомогательные утилиты:
  - `agents.py` — определение doc/rag/activity агентов и правил их работы.
  - `utils.py` — общие функции, LLM-конфиг, EndAgent и построитель графа.
- `database/` — инфраструктура базы знаний:
  - `vector_store.py` — инициализация Chroma + эмбеддинги.
  - `add_data.py` — загрузка файлов в векторную БД.
  - `chroma/` — локальное хранилище векторов.
- `docs_generated/` — выходные документы, сгруппированные по ID сессии.
- `graph/` — графы LangGraph:
  - `amain.py` — основной асинхронный граф маршрутизации.
  - `main.py` — синхронная (устаревшая) версия графа.
- `knowledge_base/` — исходная база знаний (PDF и другие материалы).
- `tools/` — инструменты для агентов:
  - `tools.py` — поиск по базе знаний + работа с журналом активности.
  - `document_template/` — шаблоны и функции генерации документов.
  - `utils.py` — служебные функции (например, нормализация ФИО).
- `graph_manager.py` — менеджер сессий для запуска графа.
- `requirements.txt` — зависимости проекта.

## Быстрый старт
1. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Настроить `.env` (пример переменных):
   ```bash
   export openai_api_key="..."
   export model_name="..."
   export openai_api_base="..."
   ```
3. Убедиться, что PostgreSQL доступен и создана таблица `employee_activity_log`.
4. Для индексации базы знаний при необходимости:
   ```bash
   python database/add_data.py
   ```

## Пример использования
Ниже краткий пример, как запустить граф и обработать сообщение:

```python
import asyncio
from graph_manager import GraphSessionManager

async def demo():
    manager = GraphSessionManager()
    message, paths = await manager("Нужен отпуск на 5 дней", id="user-1")
    print(message)
    if paths:
        print("Документы:", paths)

asyncio.run(demo())
```

## Примечания
- `docs_generated/` содержит итоговые документы, которые создаются агентом документов.
- `knowledge_base/` используется для RAG-поиска; при обновлении файлов нужно переиндексировать базу.
- Для корректной работы векторного поиска убедитесь, что доступно устройство (GPU/CPU), указанное в `database/vector_store.py`.
